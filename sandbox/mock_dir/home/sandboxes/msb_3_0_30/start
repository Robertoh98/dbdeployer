#!/bin/bash

#    DBDeployer - The MySQL Sandbox
#    Copyright (C) 2006-2020 Giuseppe Maxia
#
#    Licensed under the Apache License, Version 2.0 (the "License");
#    you may not use this file except in compliance with the License.
#    You may obtain a copy of the License at
#
#        http://www.apache.org/licenses/LICENSE-2.0
#
#    Unless required by applicable law or agreed to in writing, software
#    distributed under the License is distributed on an "AS IS" BASIS,
#    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
#    See the License for the specific language governing permissions and
#    limitations under the License.

# Generated by dbdeployer 1.73.0 using start on Thu Jun 26 18:51:24 -03 2025
source /Users/robertogarciadebem/Source codes/dbdeployer/sandbox/mock_dir/home/sandboxes/msb_3_0_30/sb_include

if [ -e $PIDFILE ]
then
  PID=$(< "$PIDFILE")
  if kill -0 "$PID" > /dev/null 2>&1
  then
    echo "sandbox server already started (found pid file $PIDFILE)"
    echo " sandbox server started"
    exit 0
  else
    # Server exited unclean
    rm -f $PIDFILE
    rm -f /Users/robertogarciadebem/Source codes/dbdeployer/sandbox/mock_dir/home/sandboxes/msb_3_0_30/data/mysql_sandbox3030.sock
  fi
fi

$BASEDIR/bin/tidb-server -config $SBDIR/tidb.toml > $SBDIR/data/tidb.log 2>&1 &
echo $! > $PIDFILE

TIMEOUT=180
ATTEMPTS=1
while [ ! -e /Users/robertogarciadebem/Source codes/dbdeployer/sandbox/mock_dir/home/sandboxes/msb_3_0_30/data/mysql_sandbox3030.sock ]
do
  ATTEMPTS=$(( $ATTEMPTS + 1 ))
  echo -n "."
  if [ $ATTEMPTS = $TIMEOUT ]
  then
    break
  fi
  sleep $SLEEP_TIME
done

if [ -e /Users/robertogarciadebem/Source codes/dbdeployer/sandbox/mock_dir/home/sandboxes/msb_3_0_30/data/mysql_sandbox3030.sock ]
then
  echo " sandbox server started"
else
  echo " sandbox server not started yet"
  exit 1
fi
