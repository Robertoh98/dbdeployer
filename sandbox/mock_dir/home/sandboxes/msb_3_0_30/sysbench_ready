#!/bin/bash

#    DBDeployer - The MySQL Sandbox
#    Copyright (C) 2006-2020 Giuseppe Maxia
#
#    Licensed under the Apache License, Version 2.0 (the "License");
#    you may not use this file except in compliance with the License.
#    You may obtain a copy of the License at
#
#        http://www.apache.org/licenses/LICENSE-2.0
#
#    Unless required by applicable law or agreed to in writing, software
#    distributed under the License is distributed on an "AS IS" BASIS,
#    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
#    See the License for the specific language governing permissions and
#    limitations under the License.

# Generated by dbdeployer 1.73.0 using sysbench_ready on Thu Jun 26 18:51:24 -03 2025
source /Users/robertogarciadebem/Source codes/dbdeployer/sandbox/mock_dir/home/sandboxes/msb_3_0_30/sb_include

option=$1
if [ -z "$option" ]
then
    echo "Syntax: $0 {prepare|run}"
    exit 1
fi

[ -z "$SB_DATABASE" ] && SB_DATABASE=sbtest

sysbench_version=$(sysbench --version | awk '{print $2}')

if [ -z "$sysbench_version" ]
then
    echo "sysbench version not found"
    exit 1
fi

linux_sysbench_path=/usr/share/sysbench
mac_os_sysbench_path=/usr/local/Cellar/sysbench/$sysbench_version/share/sysbench
sysbench_path=$linux_sysbench_path

if [ ! -d $sysbench_path ]
then
    sysbench_path=$mac_os_sysbench_path
fi
if [ ! -d $sysbench_path ]
then
    echo "sysbench path not found in either $linux_sysbench_path or $mac_os_sysbench_path"
    exit 1
fi

cd "$SBDIR"
./use -e "CREATE DATABASE IF NOT EXISTS $SB_DATABASE"
case $option in
    prepare)
      sysbench --db-driver=mysql \
	    --mysql-user=msandbox \
        --mysql-password=msandbox \
        --mysql-socket=/Users/robertogarciadebem/Source codes/dbdeployer/sandbox/mock_dir/home/sandboxes/msb_3_0_30/data/mysql_sandbox3030.sock \
        --mysql-db=$SB_DATABASE \
        --range_size=100 \
        --table_size=5000 \
        --tables=100 \
        --threads=1 \
        --events=0 \
        --time=60 \
        --rand-type=uniform \
        $sysbench_path/oltp_read_only.lua \
        prepare
    ;;
    run)
      sysbench --db-driver=mysql \
        --mysql-user=msandbox \
        --mysql-password=msandbox \
        --mysql-socket=/Users/robertogarciadebem/Source codes/dbdeployer/sandbox/mock_dir/home/sandboxes/msb_3_0_30/data/mysql_sandbox3030.sock \
        --mysql-db=$SB_DATABASE \
        --range_size=100 \
        --table_size=5000 \
        --tables=100 \
        --threads=10 \
        --events=0 \
        --time=6000 \
        --rand-type=uniform \
        $sysbench_path/oltp_read_write.lua \
        --report-interval=1 run
    ;;
    *)
      echo "invalid command '$option' - accepted: prepare|run"
      exit 1
    ;;
esac
